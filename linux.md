## Linux-how-to
* In Linux, you should work with *terminal*, which is CUI (character user interface), a different interface from GUI (graphical user interface).
* The Gaussian is usually done in remote environment, because running Gaussian on your desktop/laptop is not a good idea as it demands large CPU power, memory, and hardware in/out.
* Thus it is recommended to run the Gaussian on supercomputers. Here, we mainly use TSUBAME4.0, a Tokyo-Tech supercomputer.
* The usage of TSUBAME is introduced later. First, we will look into the basic linux commands.

## Linux environment setup
### Mac
* No need to do, just open "terminal.app".

## Windows
* Install WSL2 (Windows service for linux ver.2); following is an example in Windows 10
    1. Open "Windows Power Shell" or "Terminal" as Administrator.
    2. Type `wsl --set-default-version 2` (for safe)
    3. Type `wsl --install -d Ubuntu`.
    4. After installation is done, open `Ubuntu` in Application.

* When above doesn't work, check "Windows の機能の有効化、または無効化", then "Linux 用 Windows サブシステム", "仮想マシンプラットフォーム" is ON.
* Note that WSL makes home directory (`/home/your_name`) which is different from the Windows user directory (`C:\Users\your_name`).
* You can access Windows system from Ubuntu like: `cd` to Desktop by `cd /mnt/c/Users/your_name/Desktop/`.
* It is useful to make symbolic link between Ubuntu and Windows like
    ```bash
    cd
    ln -s /mnt/c/Users/your_user_name/Desktop/ desktop
    ```
* If some commands are unavailable (e.g. vi), install them by `sudo apt install vim`.

## ssh
* To login the supercomputer from your environment, you need to use *ssh* so you have to set up it.

## ssh key generation
* To make a ssh connection to remote environment, you need a *ssh-key*.
* There are two keys, a *public key* and  *private key*.
* To generate these keys, execute `ssh-keygen` on your linux terminal.
* You can set your passphrase if you like.
* This makes following keys.
    + `~/.ssh/id_rsa` (private key)
    + `~/.ssh/id_rsa.pub` (public key)
* After generating this, you should upload the public key to the remove environment. Keep a private key to your local environment.
* For Windows users: note that the ssh key is usually generated on the WSL home directory (`/home/yourn_user_name`). This different from the Windows home directory.

## Public key upload
1. Login a portal site with your internet browser.
2. Click "ssh public key registration" (or similar contents).
3. Copy the public key file (id_rsa_XXX.pub) generated by ssh-keygen.
4. Paste the above contents to some appropriate space.
5. Go back to terminal and login via: `ssh [account_name]@[login_node].ac.jp -i [private_key-file]`
    * In TSUBAME, `ssh [account_name]@login.t3.gsic.titech.ac.jp -i [private_key-file]`

## ssh-config
* To make next login easier, it is better to set up the ssh configure file to make login easier.
* An example of TSUBAME is (minimal configuration),
    ```bash
    Host tsubame
        HostName login.t4.gsic.titech.ac.jp
        User your_name
        IdentityFile /Users/your_name/.ssh/id_rsa_tsubame
    ```
* After that, you can login TSUBAME by `ssh tsubame`.

#### extra options
* You should add following options when you use the GaussView on TSUBAME (so if you don't use it you can skip these lines).
    ```bash
    ForwardX11Trusted yes
    Compression yes
    ```
* If you don't like the auto-logout from ssh, add following.
    ```bash
    ServerAliveInterval 60
    ServerAliveCountMax 30
    ```

## Basic linux commands
* `cd`: To change the current directory, `cd target_dir`. Note that `target_dir` should be a directory, not a file. Going upper directory, do `cd ..`.
* `ls`: To list the files and directories in the current directory, you should `ls`.
* `cp`: To copy a file, you should `cp from_file to_file`.
* `pwd`: To display the current directory, type `pwd`.
* `less`: To see the contents of file. For files more than one page, place *space* key to see further. Type `q` to quit. If you type `shift + f`, it waits the reloading the file. This mode can be quitted by `ctrl + c`.
* `grep`: To extract a line with some keyword, type `grep "keyword" filename`.
* `mkdir`: To make a new directory, type `mkdir new_dir`.

## Editor
* There are several editors in linux. Two editors are popular, *vi* and *emacs*.
* Here in this course we will use `vi`.
* You can use these editors in the remote environment.
* If you don't want to use vi/emacs, copy your target file to local PC and then use your favorite editor, then send it back to remote environment.
* However, your editor should output the text file with Linux-compatible newline code.
* Newline code depends on the OS (operating system).
    * Linux and Mac (after Mac OS X): LF(Line Feed)
    * Windows: CR（Carriage Return）+ LF.
* So use VS Code, sakura editor, K2E, etc.

## vi
* Minimal instruction of vi.
    * open file: `vi file.txt`
    * vi has two modes: command mode and inseert mode
    * command mode to insert mode: `i`
    * insert mode to command mode: `esc`
    * you can put character only in the insert mode
    * move: `j`(down), `k`(up), `l`(right), `h`(left)
    * deleting character: `x` (no need to be insert mode)
    * insert new line (then go to insert mode): `o`
    * save and exit: `:wq`
    * exit without saving: `:q!`

## scp
* After making a ssh-login environment, you can use `scp` (means secure copy) to send/take file from/to remote environment.
    * send: `scp your_file login_node:directory`
        * e.g. sending Gaussian input file (in the current directory) to TSUBAME: `scp h2o.com tsubame@/home/1/ABCD1234/gaussian`
    * take: `scp login_node:directory your_local_directory`
        * e.g. getting Gaussian output file in TSUBAME to your local computer: `scp tsubame@/home/1/ABCD1234/gaussian/h2o.log ./`

## submitting jobs
* Edit your script file (e.g. `script.sh`) and execute `qsub -g your_group_name script.sh`.
* For details, see "tsubame.md" for details.
